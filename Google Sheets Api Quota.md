# Квоты Google Sheets API и безопасная частота запросов

## Основные лимиты (по умолчанию)

| Категория                                                   | На проект              | На пользователя       | Что считается вызовом                                  |
| ----------------------------------------------------------- | ---------------------- | --------------------- | ------------------------------------------------------ |
| **Чтение** (`spreadsheets.values.get`, `batchGet`, …)       | **300 запросов / мин** | **60 запросов / мин** | Один HTTP‑запрос, даже если в нём несколько диапазонов |
| **Запись** (`spreadsheets.values.update`, `batchUpdate`, …) | **300 запросов / мин** | **60 запросов / мин** | Один HTTP‑запрос, даже если в нём несколько операций   |

> Workspace‑квота 100 запросов / 100 с на пользователя и 500 запросов / 100 с на проект также может применяться, если задействован Drive API.

## Что это значит на практике (2‑3 клиента)

* **Пул проекта:** 300 read + 300 write = ≈5 запросов/с.
  При двух пользователях каждому достаётся \~2‑2,5 запроса/с.

* **Пул пользователя:** 60 read + 60 write = по 1 запросу/с на чтение и запись.
  Безопасный интервал — **не чаще одного запроса каждые 2 с** (≈30 read/min).

## Приёмы, чтобы не ловить `429 Too Many Requests`

| Приём                                            | Кратко зачем                                       |
| ------------------------------------------------ | -------------------------------------------------- |
| **Batch‑запросы** (`batchGet`, `batchUpdate`)    | Несколько операций → один вызов                    |
| **Push‑уведомления Drive API** (`changes.watch`) | Сервер сам сообщает об изменениях, квоту не тратит |
| **ETag + локальный кэш**                         | Опрос только при смене версии                      |
| **Экспоненциальный backoff**                     | Увеличиваем задержку при `429`                     |
| **Дебаунс записей**                              | Группируем правки за 300‑500 мс                    |
| **Пачкуем записи**                               | 5‑10 изменений → 1 `batchUpdate`                   |

## Базовый безопасный тайминг для SPA‑дашборда

| Действие                    | Интервал                              | Обоснование                                |
| --------------------------- | ------------------------------------- | ------------------------------------------ |
| Обновление данных на экране | Polling 3‑5 с **или** `changes.watch` | 12‑20 read/min на клиента — запас по квоте |
| Сохранение правок           | Дебаунс 0,5‑2 с + `batchUpdate`       | 5‑10 write/min при активном вводе          |
| Полный ре‑fetch/сброс кэша  | 30‑60 с или вручную                   | Не забивает общий пул                      |

## Если нужно чаще

* Подайте заявку на повышение квот в консоли GCP (часто дают ×5–10).
* Разносите нагрузку: чтение/запись — через Sheets API, тяжёлые выборки — через Apps Script Web App или кеш‑бэкенд.

---

### Итог

**≤ 1 read + 1 write в секунду на активного пользователя** достаточно, чтобы фронт обновлялся каждые пару секунд и спокойно сохранял правки. Всё, что быстрее, делаем через batch‑операции или push‑уведомления.
